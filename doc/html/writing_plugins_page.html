<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gyoto: Writing plug-ins for Gyoto</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Gyoto
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Writing plug-ins for <a class="el" href="namespace_gyoto.html" title="Namespace for the Gyoto library.">Gyoto</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Al the generic <a class="el" href="namespace_gyoto.html" title="Namespace for the Gyoto library.">Gyoto</a> machinery for computing orbits, reading input files, performing ray-tracing etc. is implemented in libgyoto. On the other hand, all the code specific to a given metric kind or a given astronomical object is available in plug-ins. For instance, the standard plug-in libgyoto-stdplug contains the two flavors of the Kerr metric: Gyoto::KerrBL and Gyoto::KerrKS, as well as basic objects: Gyoto::FixedStar, Gyoto::Star, Gyoto::Torus, Gyoto::ThinInfiniteDiskBL and Gyoto::ThinInfiniteDiskKS. The libgyoto-lorene plug-in contains the code to access numerical metrics (Gyoto::LoreneMetric) as well as an example thereof: Gyoto::RotStar3_1. The two basic spectral shapes <a class="el" href="class_gyoto_1_1_spectrum_1_1_power_law.html" title="I_nu=constant_*nu^exponent_.">Gyoto::Spectrum::PowerLaw</a> and <a class="el" href="class_gyoto_1_1_spectrum_1_1_black_body.html" title="Black Body.">Gyoto::Spectrum::BlackBody</a> are also to be found in the standard plug-in.</p>
<p><a class="el" href="namespace_gyoto.html" title="Namespace for the Gyoto library.">Gyoto</a> can be used right away to compute stellar orbits in the Kerr metric or to do basic ray-tracing of accretion disks. But <a class="el" href="namespace_gyoto.html" title="Namespace for the Gyoto library.">Gyoto</a> is not limited to the basic metrics and objects we have thought of. It is fairly easy to add custom metrics and objects (and emission/absorption laws) it <a class="el" href="namespace_gyoto.html" title="Namespace for the Gyoto library.">Gyoto</a>, and <a class="el" href="namespace_gyoto.html" title="Namespace for the Gyoto library.">Gyoto</a> itself does not need to be modified or even re-compiled to do so: custom classes can (and should) be implemented as plug-ins. For an example, simply look at the lib/StdPlug.C file in the source distribution, and the source files for the objects and metrics it provides: e.g. lib/FixedStar.C and lib/KerrBL.C.</p>
<p>To implement a new plug-in, you first need to implement a derived class of either the <a class="el" href="namespace_gyoto_1_1_astrobj.html" title="Access to astronomical objects.">Gyoto::Astrobj</a>, <a class="el" href="namespace_gyoto_1_1_metric.html" title="Access to metrics.">Gyoto::Metric</a>, or <a class="el" href="class_gyoto_1_1_spectrum_1_1_generic.html" title="Spectrum emitted by an Astrobj.">Gyoto::Spectrum::Generic</a> class. You don't necessarily need to implement everything, the <a class="el" href="namespace_gyoto_1_1_astrobj.html" title="Access to astronomical objects.">Gyoto::Astrobj</a> page explains what is required for an astronomical object.</p>
<p>Assuming you want to be able to actually use your custom class, you need a way to instantiate it. This is normally the job of the <a class="el" href="class_gyoto_1_1_factory.html" title="XML input/output.">Gyoto::Factory</a>. You need to instruct the <a class="el" href="class_gyoto_1_1_factory.html" title="XML input/output.">Gyoto::Factory</a> how to read parameters for your specific class from an XML file by implementing a subcontractor (for a <a class="el" href="namespace_gyoto_1_1_astrobj.html" title="Access to astronomical objects.">Gyoto::Astrobj</a>, the subcontractor is a static method of the <a class="el" href="namespace_gyoto_1_1_astrobj.html#aa53c7ada58c8c8f3799c3485b7d8f3bb" title="A function to build instances of a specific Astrobj::Generic sub-class.">Gyoto::Astrobj::Subcontractor_t</a> type). The subcontractor communicates with the <a class="el" href="class_gyoto_1_1_factory.html" title="XML input/output.">Gyoto::Factory</a> by means of a <a class="el" href="class_gyoto_1_1_factory_messenger.html" title="Factory / SmartPointee::Subcontractor_t interface.">Gyoto::FactoryMessenger</a> and basically loops calling the <a class="el" href="class_gyoto_1_1_factory_messenger.html#a716340221e527c61a05af389590b53f4" title="Get name and value of next parameter.">Gyoto::FactoryMessenger::getNextParameter()</a> method (see the <a class="el" href="_gyoto_register_8h.html" title="Gyoto registers.">GyotoRegister.h</a> file, unfortunately undocumented at the moment).</p>
<p>You also need to register your subcontractor, so that the <a class="el" href="class_gyoto_1_1_factory.html" title="XML input/output.">Gyoto::Factory</a> knows it must call it when it encounters a tag of the form &lt;Astrobj kind=&quot;YourKind&quot;&gt; in an XML description. This is typically done by providing an static Init method in your class: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="namespace_gyoto_1_1_units.html#aade66d5933d035fb5f0fbb0501e9e972">Gyoto::FixedStar::Init</a>() {</div>
<div class="line">  <a class="code" href="namespace_gyoto_1_1_astrobj.html#abb6caf3023a51cb77b5f6793ac03b188">Gyoto::Astrobj::Register</a>(<span class="stringliteral">&quot;FixedStar&quot;</span>, &amp;<a class="code" href="namespace_gyoto_1_1_astrobj.html#a889583a9d40c821bd55c4191cb3201ed">Gyoto::FixedStar::Subcontractor</a>);</div>
<div class="line">}</div>
<div class="ttc" id="anamespace_gyoto_1_1_astrobj_html_a889583a9d40c821bd55c4191cb3201ed"><div class="ttname"><a href="namespace_gyoto_1_1_astrobj.html#a889583a9d40c821bd55c4191cb3201ed">Gyoto::Astrobj::Subcontractor</a></div><div class="ttdeci">SmartPointer&lt; Astrobj::Generic &gt; Subcontractor(FactoryMessenger *fmp, std::vector&lt; std::string &gt; const &amp;plugin)</div><div class="ttdoc">A template for Subcontractor_t functions.</div><div class="ttdef"><b>Definition:</b> GyotoAstrobj.h:77</div></div>
<div class="ttc" id="anamespace_gyoto_1_1_astrobj_html_abb6caf3023a51cb77b5f6793ac03b188"><div class="ttname"><a href="namespace_gyoto_1_1_astrobj.html#abb6caf3023a51cb77b5f6793ac03b188">Gyoto::Astrobj::Register</a></div><div class="ttdeci">void Register(std::string name, Gyoto::Astrobj::Subcontractor_t *scp)</div><div class="ttdoc">Make an Astrobj kind known to the Factory.</div></div>
<div class="ttc" id="anamespace_gyoto_1_1_units_html_aade66d5933d035fb5f0fbb0501e9e972"><div class="ttname"><a href="namespace_gyoto_1_1_units.html#aade66d5933d035fb5f0fbb0501e9e972">Gyoto::Units::Init</a></div><div class="ttdeci">void Init()</div><div class="ttdoc">Load and initialize all (non-context-sensitive) units.</div></div>
</div><!-- fragment --><p>You need to make sure this <a class="el" href="namespace_gyoto_1_1_units.html#aade66d5933d035fb5f0fbb0501e9e972" title="Load and initialize all (non-context-sensitive) units.">Init()</a> method is called when your plug-in is loaded. Assume you decide to call your plug-in MyPlug, and it contains a single <a class="el" href="namespace_gyoto_1_1_astrobj.html" title="Access to astronomical objects.">Gyoto::Astrobj</a> named Gyoto::MyObj. You will compile it under the file name libgyoto-MyPlug.so (under Linux) or libgyoto-MyPlug.dylib (under MacOS X). Just put this file somewhere where the dynamic linker can find it (any directory listed in $LD_LIBRARY_PATH or $DYLD_LIBRARY_PATH will be fine; /usr/local/lib/ should also be fine). In addition to the implementation of the Gyoto::MyObj class, you will need to provide a function called __GyotoMyPlugInit() which will be exactly this: </p><div class="fragment"><div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> __GyotostdplugInit() {</div>
<div class="line">  <a class="code" href="namespace_gyoto_1_1_units.html#aade66d5933d035fb5f0fbb0501e9e972">Gyoto::MyObj::Init</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p> This function is typically provided in a separate source file (such as lib/StdPlug.C in the <a class="el" href="namespace_gyoto.html" title="Namespace for the Gyoto library.">Gyoto</a> source) and can initialize several custom classes at once.</p>
<p>Finally, you need to instruct <a class="el" href="namespace_gyoto.html" title="Namespace for the Gyoto library.">Gyoto</a> to load your plug-in at run time. This is done by adding the name of your plug-in to the GYOTO_PLUGINS environment variable. The default value for GYOTO_PLUGINS is "stdplug,nofail:lorene", meaning <a class="el" href="namespace_gyoto.html" title="Namespace for the Gyoto library.">Gyoto</a> should load the standard plug-in stdplug and attempt to load the lorene plug-in, failing only if stdplug is nowhere to be found. If you want to load your plug-in in addition to those, alter this variable in your shell (if you don't know what this means or how to do this, ask the local Unix guru or read the fine <a href="http://www.gnu.org/s/bash/manual/bash.html">manual</a>): </p><div class="fragment"><div class="line">export GYOTO_PLUGINS=<span class="stringliteral">&quot;stdplug,nofail:lorene,MyPlug&quot;</span></div>
</div><!-- fragment --><p> but if your lug-in is self-contained and your don't need the objects in the standard plug-ins, this will do it for you: </p><div class="fragment"><div class="line">export GYOTO_PLUGINS=<span class="stringliteral">&quot;MyPlug&quot;</span></div>
</div><!-- fragment --><p> This will instruct <a class="el" href="namespace_gyoto.html" title="Namespace for the Gyoto library.">Gyoto</a> to locate and load the file named libgyoto-MyPlug.(so|dylib) and to run the function named __GyotostdplugInit() from this library file. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
